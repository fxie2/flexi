clear;
P1 = [-1,-1,-1]';
P2 = [+1,-1,-1]';
P3 = [+1,+1,-1]';
P4 = [-1,+1,-1]';
P5 = [-1,-1,+1]';
P6 = [+1,-1,+1]';
P7 = [+1.,+1.2,+1.]';
P8 = [-1.2,+1,+1]';
m = 1000;
P1 = P1 * m;
P2 = P2 * m;
P3 = P3 * m;
P4 = P4 * m;
P5 = P5 * m;
P6 = P6 * m;
P7 = P7 * m;
P8 = P8 * m;
K1 = 1/8*(P1+P2+P3+P4+P5+P6+P7+P8);
%K2 = 1/2* (-P1+P2);  
%K3 = 1/2* (-P1+P4);
%K4 = 1/2* (-P1+P5);
K2 = 1/8*(-P1+P2+P3-P4-P5+P6+P7-P8);
K3 = 1/8*(-P1-P2+P3+P4-P5-P6+P7+P8);
K4 = 1/8*(-P1-P2-P3-P4+P5+P6+P7+P8);
T(:,1) = 0.5* (P2-P1);
T(:,2) = 0.5* (P4-P1);
T(:,3) = 0.5* (P5-P1);


KM(:,1) = K2;
KM(:,2) = K3;
KM(:,3) = K4;
KM_inv = inv(KM);

x = [0.3,0.4,0.5]'*m;
xi = KM_inv*x-K1;

% Now do newton method:
[F,dF]=NewtonFunc(xi,x,P1,P2,P3,P4,P5,P6,P7,P8);
%for j=1:5
i = 0;
%s=1
while sum(abs(F)) >= 1E-8
  dF_inv = inv(dF);
  %s=dF\F;
  s=dF_inv*F;
  i=i+1;
  xi=xi-s;
  [F,dF]=NewtonFunc(xi,x,P1,P2,P3,P4,P5,P6,P7,P8);
end
i

% Test
xi

1/8 * (P1*(1-xi(1)) * (1-xi(2)) * (1-xi(3)) ...
         + P2*(1+xi(1)) * (1-xi(2)) * (1-xi(3)) ...
         + P3*(1+xi(1)) * (1+xi(2)) * (1-xi(3)) ...
         + P4*(1-xi(1)) * (1+xi(2)) * (1-xi(3)) ...
         + P5*(1-xi(1)) * (1-xi(2)) * (1+xi(3)) ...
         + P6*(1+xi(1)) * (1-xi(2)) * (1+xi(3)) ...
         + P7*(1+xi(1)) * (1+xi(2)) * (1+xi(3)) ...
         + P8*(1-xi(1)) * (1+xi(2)) * (1+xi(3)))